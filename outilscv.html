<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateur de CV Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=JetBrains+Mono&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- React & Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- External libraries for export functionalities -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script src="https://unpkg.com/docx@8.5.0/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styles pour le CV */
        .cv-section, .cv-item, .cv-header {
            page-break-inside: avoid;
        }
        .timeline {
            position: relative;
            padding-left: 25px;
            border-left: 2px solid #e5e7eb;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -34px; /* Ajusté pour l'alignement */
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid var(--primary-color, #4f46e5);
        }
        /* Animation simple pour le loader */
        .spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="root"></div>

    <script type="text/babel">
        // --- Icon Library (Lucide SVGs) ---
        const LucideIcons = {
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></svg>,
            User: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>,
            Briefcase: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></svg>,
            Mail: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="16" x="2" y="4" rx="2" /><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7" /></svg>,
            Phone: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" /></svg>,
            MapPin: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14" /><path d="M12 5v14" /></svg>,
            Palette: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor" /><circle cx="17.5" cy="10.5" r=".5" fill="currentColor" /><circle cx="8.5" cy="7.5" r=".5" fill="currentColor" /><circle cx="6.5" cy="12.5" r=".5" fill="currentColor" /><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.668 0-.92-.722-1.667-1.648-1.667-.926 0-1.648-.746-1.648-1.668 0-.92-.722-1.667-1.648-1.667-.926 0-1.648-.746-1.648-1.668 0-.92-.722-1.667-1.648-1.667A4.318 4.318 0 0 1 6.352 8.5c0-.92-.722-1.667-1.648-1.667S3.056 7.58 3.056 8.5A4.318 4.318 0 0 0 7.352 12.833c0 .92.722 1.667 1.648 1.667.926 0 1.648.746 1.648 1.668 0 .92.722 1.667 1.648 1.667.926 0 1.648.746 1.648 1.668 0 .92.722 1.667 1.648 1.667s1.648-.747 1.648-1.667A4.318 4.318 0 0 0 21.648 12c0-5.5-4.5-10-10-10-1.648 0-2.994.39-4.252 1.05" /></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M19 17v4" /><path d="M3 5h4" /><path d="M17 19h4" /></svg>,
            LoaderCircle: (props) => <svg {...props} className="spin" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>,
            ShieldCheck: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><path d="m9 12 2 2 4-4" /></svg>,
            CheckCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><path d="m9 11 3 3L22 4" /></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" /><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" /><polyline points="14 2 14 8 20 8" /><line x1="16" x2="8" y1="13" y2="13" /><line x1="16" x2="8" y1="17" y2="17" /><line x1="10" x2="8" y1="9" y2="9" /></svg>,
            Wand: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 4V2" /><path d="M15 16v-2" /><path d="M8 9h2" /><path d="M20 9h2" /><path d="M17.8 11.8 19 13" /><path d="M15 9h.01" /><path d="M17.8 6.2 19 5" /><path d="M6.2 6.2 5 5" /><path d="M6.2 11.8 5 13" /><path d="m3 21 9-9" /><path d="M12.2 6.2 11 5" /></svg>,
            Edit3: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9" /><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z" /></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.12l-.15.1a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1 0-2.12l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
            Info: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></svg>,
            RefreshCcw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v6h6" /><path d="M21 12A9 9 0 0 0 6 5.3L3 8" /><path d="M21 22v-6h-6" /><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7" /></svg>,
            AlertTriangle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></svg>,
            ZoomOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8" /><line x1="21" x2="16.65" y1="21" y2="16.65" /><line x1="8" x2="14" y1="11" y2="11" /></svg>,
            ZoomIn: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8" /><line x1="21" x2="16.65" y1="21" y2="16.65" /><line x1="11" x2="11" y1="8" y2="14" /><line x1="8" x2="14" y1="11" y2="11" /></svg>,
            RotateCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>,
            Calendar: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></svg>,
            Map: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21" /><line x1="9" x2="9" y1="3" y2="18" /><line x1="15" x2="15" y1="6" y2="21" /></svg>,
            Euro: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 10h12" /><path d="M4 14h12" /><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2.5 0 4.8-.9 6.2-2.7" /></svg>,
            Text: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 6.1H7" /><path d="M21 12.1H3" /><path d="M15 18.1H9" /></svg>,
            ChevronDown: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6" /></svg>,
            ArrowLeftRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8 3 4 7l4 4" /><path d="M4 7h16" /><path d="m16 21 4-4-4-4" /><path d="M20 17H4" /></svg>,
            Move: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="5 9 2 12 5 15" /><polyline points="9 5 12 2 15 5" /><polyline points="15 19 12 22 9 19" /><polyline points="19 9 22 12 19 15" /><line x1="2" x2="22" y1="12" y2="12" /><line x1="12" x2="12" y1="2" y2="22" /></svg>,
            EyeOff: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24" /><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68" /><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61" /><line x1="2" x2="22" y1="2" y2="22" /></svg>,
            Camera: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z" /><circle cx="12" cy="13" r="3" /></svg>,
            Circle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /></svg>,
            Square: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" /></svg>,
            Star: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>,
            LinkIcon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72" /></svg>,
            Github: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" /><path d="M9 18c-4.51 2-5-2-7-2" /></svg>,
            Twitter: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 1.4 3.3 4.4 3.3 4.4s-1.4 1.4-2.1 1.4H18s-1.4-1.4-2.1-2.8c0 0-4.1 5.6-8.2 5.6s-5.6-3.3-5.6-3.3c0 0 2.1 1.4 5.6 0 3.5-1.4 8.2-9.6 8.2-9.6s1.4-2.1 2.8-2.1c0 0 .7 1.4 2.1 2.8Z" /></svg>,
            Globe: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" /><path d="M2 12h20" /></svg>,
            Heart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" /></svg>,
            Code: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></svg>,
            BookOpen: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></svg>,
            Plane: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1.5-1.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z" /></svg>,
            default: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72" /></svg>
        };

        const { useState, useEffect, useRef } = React;

        // --- DATA INITIALE & EXEMPLES (déplacé ici pour corriger l'erreur de scope) ---
        const emptyCvData = {
            personal: { firstName: '', lastName: '', title: '', email: '', phone: '', address: '', summary: '', onlineProfileUrl: '', availability: '', salaryExpectations: '', location: '' },
            experiences: [], projects: [], education: [], skills: [], awards: [], languages: [], hobbies: [], socials: [], customSections: []
        };

        const exampleData = {
            dev: { 
                personal: { firstName: 'Léa', lastName: 'Martin', title: 'Développeuse Full-Stack', email: 'lea.martin@email.dev', phone: '+33 7 11 22 33 44', address: 'Paris, France', summary: 'Développeuse passionnée avec 5 ans d\'expérience en React et Node.js. Adepte du code propre et des tests unitaires, je cherche à construire des applications performantes et scalables.', availability: 'Immédiate', salaryExpectations: '55-65k€', location: 'Paris ou télétravail' }, 
                experiences: [{ id: 1, company: 'Tech Startup', position: 'Développeuse Senior', startDate: '2020', endDate: 'Présent', description: 'Développement de nouvelles fonctionnalités, maintenance de l\'application principale et mentorat des développeurs juniors.' }, { id: 2, company: 'Web Agency', position: 'Développeuse Junior', startDate: '2018', endDate: '2020', description: 'Intégration de maquettes et développement de sites vitrines.' }],
                projects: [{ id: 1, name: 'Portfolio Interactif', url: 'lea-martin.dev', description: 'Création d\'un site personnel en Next.js avec des animations Three.js.' }],
                education: [{ id: 1, institution: 'École 42', degree: 'Architecte en Technologies du Numérique', startDate: '2017', endDate: '2020', description: 'Formation par projets en peer-learning.' }],
                skills: [{id: 1, category: 'Frontend', name: 'React', level: 5, icon: 'code'}, {id: 2, category: 'Backend', name: 'Node.js', level: 5, icon: 'code'}, {id: 3, category: 'Langages', name: 'TypeScript', level: 4, icon: 'code'}, {id: 4, category: 'API', name: 'GraphQL', level: 4, icon: 'code'}],
                awards: [],
                languages: [ { id: 1, name: 'Français', level: 'Natif' }, { id: 2, name: 'Anglais', level: 'Technique' } ],
                hobbies: [ { id: 1, name: 'Jeux de stratégie', icon: 'Star' }, { id: 2, name: 'Open Source', icon: 'Code' } ],
                socials: [{ id: 1, network: 'github', url: 'https://github.com/leamartin' }],
                customSections: []
            },
            manager: { 
                personal: { firstName: 'Julien', lastName: 'Petit', title: 'Product Manager', email: 'j.petit@email.pro', phone: '+33 6 55 66 77 88', address: 'Bordeaux, France', summary: 'Product Manager avec 10 ans d\'expérience dans la définition de stratégies produit et la gestion de roadmaps. Je fais le pont entre les équipes techniques, le design et le business pour livrer des produits qui ravissent les utilisateurs.', availability: 'Sous 1 mois', salaryExpectations: '70k€+', location: 'Bordeaux' }, 
                experiences: [{ id: 1, company: 'SaaS Company', position: 'Head of Product', startDate: '2018', endDate: 'Présent', description: 'Définition de la vision produit, gestion d\'une équipe de 5 Product Owners et analyse des KPIs pour orienter les décisions stratégiques.' }],
                projects: [],
                education: [{ id: 1, institution: 'Kedge Business School', degree: 'Master in Management', startDate: '2008', endDate: '2012', description: 'Spécialisation Marketing & Stratégie.' }],
                skills: [{id: 1, category: 'Stratégie', name: 'Product Strategy', level: 5, icon: 'lightbulb'}, {id: 2, category: 'Planning', name: 'Roadmap Planning', level: 5, icon: 'map'}, {id: 3, category: 'Recherche', name: 'User Research', level: 5, icon: 'users'}, {id: 4, category: 'Analyse', name: 'Data Analysis', level: 4, icon: 'bar-chart-2'}],
                awards: [],
                languages: [ { id: 1, name: 'Français', level: 'Natif' }, { id: 2, name: 'Anglais', level: 'Bilingue' } ],
                hobbies: [ { id: 1, name: 'Économie', icon: 'BookOpen' }, { id: 2, name: 'Voyages', icon: 'Plane' } ],
                socials: [{ id: 1, network: 'linkedin', url: 'https://linkedin.com/in/julienpetit' }],
                customSections: []
            },
        };

        const initialRecruiterData = { name: 'Lyes AMARA', title: 'Responsable Recrutement BTP', company: 'LTD Recrutement', phone: '01 56 02 12 25', mobile: '06 34 25 32 96', email: 'l.amara@ltd-international.com' };

        // --- COMPOSANT PRINCIPAL ---
        const CVGenerator = () => {
            // --- STATE MANAGEMENT ---
            const [cvData, setCvData] = useState(() => { try { const d = localStorage.getItem('cvData_v8'); return d ? JSON.parse(d) : emptyCvData; } catch (e) { return emptyCvData; } });
            const [recruiterData, setRecruiterData] = useState(() => { try { const d = localStorage.getItem('recruiterData_v8'); return d ? JSON.parse(d) : initialRecruiterData; } catch (e) { return initialRecruiterData; } });

            const [activeTemplate, setActiveTemplate] = useState('modern');
            const [activePalette, setActivePalette] = useState('indigo');
            const [activeLayout, setActiveLayout] = useState('two');
            const [columnRatio, setColumnRatio] = useState('large-right');
            const [activeFont, setActiveFont] = useState('sans');
            const [previewMode, setPreviewMode] = useState(false);
            const [isAnonymized, setIsAnonymized] = useState(false);
            const [isDownloadingPdf, setIsDownloadingPdf] = useState(false);
            const [isDownloadingWord, setIsDownloadingWord] = useState(false);
            const [showRecruiterBanner, setShowRecruiterBanner] = useState(true);
            const [showVCardQR, setShowVCardQR] = useState(false);
            const [photo, setPhoto] = useState(null);
            const [photoShape, setPhotoShape] = useState('round');
            const [sectionTitleStyle, setSectionTitleStyle] = useState('border');
            const [experienceStyle, setExperienceStyle] = useState('default');
            const [headerAlignment, setHeaderAlignment] = useState('center');
            const [previewScale, setPreviewScale] = useState(0.8);
            const [baseFontSize, setBaseFontSize] = useState(10);
            const [nameFontSize, setNameFontSize] = useState(28);
            const [sectionTitleFontSize, setSectionTitleFontSize] = useState(12);
            const [lineHeight, setLineHeight] = useState(1.5);
            const [pagePadding, setPagePadding] = useState(1.5);
            const [sectionSpacing, setSectionSpacing] = useState(1.25);
            const [itemSpacing, setItemSpacing] = useState(1);
            const [skillDisplayStyle, setSkillDisplayStyle] = useState('bars');
            const [draggedBlock, setDraggedBlock] = useState(null);
            const [aiInput, setAiInput] = useState('');
            const [isAiLoading, setIsAiLoading] = useState(false);
            const [isAiSynthesizing, setIsAiSynthesizing] = useState(false);
            const [aiError, setAiError] = useState('');
            const [isOverflowing, setIsOverflowing] = useState(false);
            const [isSimplified, setIsSimplified] = useState(false);
            const [salesEmail, setSalesEmail] = useState('');
            const [isGeneratingEmail, setIsGeneratingEmail] = useState(false);
            const [copied, setCopied] = useState(false);
            const [injectionNotes, setInjectionNotes] = useState('');
            const [isInjecting, setIsInjecting] = useState(false);
            const [activeEditorTab, setActiveEditorTab] = useState('ia');
            const [connectionStatus, setConnectionStatus] = useState('pending'); // 'pending', 'testing', 'ok', 'error'
            
            const cvPreviewRef = useRef();
            const cvContentRef = useRef();
            const vCardQrCodeRef = useRef();
            const chartRef = useRef(null);
            const skillChartCanvasRef = useRef(null);
            const [visibility, setVisibility] = useState({ personal: true, skills: true, languages: true, hobbies: true, experiences: {}, projects: {}, education: {}, awards: {}, socials: {} });

            const [blockOrder, setBlockOrder] = useState(['socials', 'experiences', 'projects', 'education', 'awards', 'skills', 'languages', 'hobbies']);
            const [columnAssignment, setColumnAssignment] = useState({ left: ['personal', 'skills', 'languages', 'hobbies'], right: ['socials', 'experiences', 'projects', 'education', 'awards'] });
            
            // --- CONFIGURATIONS ---
            const templates = { modern: { name: 'Moderne' }, classic: { name: 'Classique' }, creative: { name: 'Créatif' }, minimalist: { name: 'Minimaliste' }, tech: { name: 'Tech' } };
            const layouts = { single: { name: 'Une colonne' }, two: { name: 'Deux colonnes' } };
            const fonts = { sans: { name: 'Inter (Sans)', family: "'Inter', sans-serif" }, serif: { name: 'Lora (Serif)', family: "'Lora', serif" }, mono: { name: 'JetBrains Mono', family: "'JetBrains Mono', monospace" } };
            const palettes = {
                indigo: { name: 'Indigo', primary: '#4f46e5', secondary: '#eef2ff', accent: '#3730a3', textOnPrimary: '#ffffff' },
                ocean: { name: 'Océan', primary: '#0891b2', secondary: '#ecfeff', accent: '#164e63', textOnPrimary: '#ffffff' },
                forest: { name: 'Forêt', primary: '#166534', secondary: '#f0fdf4', accent: '#14532d', textOnPrimary: '#ffffff' },
                sunset: { name: 'Crépuscule', primary: '#ea580c', secondary: '#fff7ed', accent: '#c2410c', textOnPrimary: '#ffffff' },
                monochrome: { name: 'Monochrome', primary: '#1f2937', secondary: '#f9fafb', accent: '#111827', textOnPrimary: '#ffffff' }
            };
            const socialIcons = { linkedin: LucideIcons.LinkIcon, github: LucideIcons.Github, twitter: LucideIcons.Twitter, globe: LucideIcons.Globe, default: LucideIcons.LinkIcon };
            const editorTabs = [
                { id: 'ia', label: 'Assistant IA', icon: LucideIcons.Sparkles },
                { id: 'personalisation', label: 'Personnalisation IA', icon: LucideIcons.Wand },
                { id: 'vente', label: 'Email de Vente IA', icon: LucideIcons.Mail },
                { id: 'contenu', label: 'Contenu du CV', icon: LucideIcons.Edit3 },
                { id: 'design', label: 'Design & Mise en Page', icon: LucideIcons.Palette },
                { id: 'options', label: 'Options Avancées', icon: LucideIcons.Settings },
            ];
            
            const hobbyIcons = { Code: LucideIcons.Code, BookOpen: LucideIcons.BookOpen, Plane: LucideIcons.Plane, Star: LucideIcons.Star, Heart: LucideIcons.Heart, default: LucideIcons.Heart };

            // --- EFFECTS ---
            const testBackendConnection = async () => {
                setConnectionStatus('testing');
                try {
                    const response = await fetch('https://simulateur-ltd.onrender.com/');
                    if (response.ok) {
                        setConnectionStatus('ok');
                    } else {
                        setConnectionStatus('error');
                    }
                } catch (error) {
                    console.error("Connection test failed:", error);
                    setConnectionStatus('error');
                }
            };

            useEffect(() => {
                testBackendConnection();
            }, []);

            useEffect(() => { try { localStorage.setItem('cvData_v8', JSON.stringify(cvData)); localStorage.setItem('recruiterData_v8', JSON.stringify(recruiterData)); } catch (e) { console.error("Could not save data:", e); } }, [cvData, recruiterData]);
            
            useEffect(() => {
                if (showVCardQR && window.qrcode) {
                    try {
                        const { firstName, lastName, email, phone } = cvData.personal;
                        const vCardData = `BEGIN:VCARD\nVERSION:3.0\nN:${lastName};${firstName}\nFN:${firstName} ${lastName}\nEMAIL:${email}\nTEL:${phone}\nEND:VCARD`;
                        const qr = window.qrcode(0, 'M'); qr.addData(vCardData); qr.make();
                        if (vCardQrCodeRef.current) { vCardQrCodeRef.current.innerHTML = qr.createImgTag(4, 8); }
                    } catch (e) { console.error("vCard QR Code generation failed:", e); }
                }
            }, [showVCardQR, cvData.personal]);

            useEffect(() => {
                setVisibility(prev => {
                    const newVisibility = { ...prev };
                    ['experiences', 'projects', 'education', 'awards', 'socials'].forEach(section => {
                        const sectionVisibility = { ...(newVisibility[section] || {}) };
                        (cvData[section] || []).forEach(item => {
                            if (sectionVisibility[item.id] === undefined) {
                                sectionVisibility[item.id] = true;
                            }
                        });
                        newVisibility[section] = sectionVisibility;
                    });
                    return newVisibility;
                });
            }, [cvData]);

            useEffect(() => {
                const checkOverflow = () => {
                    const contentElement = cvContentRef.current;
                    if (contentElement) {
                        const a4HeightInPx = 297 * (96 / 25.4); 
                        setIsOverflowing(contentElement.scrollHeight > a4HeightInPx + 5);
                    }
                };
                const timeoutId = setTimeout(checkOverflow, 150);
                return () => clearTimeout(timeoutId);
            }, [cvData, activeLayout, columnRatio, activeFont, baseFontSize, nameFontSize, sectionTitleFontSize, lineHeight, pagePadding, sectionSpacing, itemSpacing, photo, showRecruiterBanner]);

            useEffect(() => {
                if (skillDisplayStyle === 'radar' && skillChartCanvasRef.current) {
                    if (chartRef.current) chartRef.current.destroy();
                    const ctx = skillChartCanvasRef.current.getContext('2d');
                    const currentPalette = palettes[activePalette] || {primary: '#4f46e5'};
                    chartRef.current = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: cvData.skills.map(s => s.name),
                            datasets: [{
                                label: 'Niveau de Compétence',
                                data: cvData.skills.map(s => s.level),
                                backgroundColor: `${currentPalette.primary}33`,
                                borderColor: currentPalette.primary,
                                borderWidth: 2,
                            }]
                        },
                        options: { scales: { r: { beginAtZero: true, max: 5, stepSize: 1 } }, plugins: { legend: { display: false } } }
                    });
                }
                return () => { if (chartRef.current) chartRef.current.destroy(); };
            }, [skillDisplayStyle, cvData.skills, activePalette]);

            // --- HANDLERS ---
            const handleCvDataChange = (section, field, value) => setCvData(p => ({ ...p, [section]: { ...p[section], [field]: value } }));
            const handleRecruiterDataChange = (field, value) => setRecruiterData(p => ({ ...p, [field]: value }));
            const handleListItemChange = (section, id, field, value) => setCvData(p => ({ ...p, [section]: p[section].map(i => i.id === id ? { ...i, [field]: value } : i) }));
            
            const addListItem = (section) => {
                const newItem = { id: Date.now(), ...(section === 'experiences' && { company: '', position: '', startDate: '', endDate: '', description: '' }), ...(section === 'projects' && { name: '', url: '', description: '' }), ...(section === 'education' && { institution: '', degree: '', startDate: '', endDate: '', description: '' }), ...(section === 'awards' && { name: '', issuer: '', date: '', description: '' }), ...(section === 'skills' && { category: 'Nouvelle Catégorie', name: '', level: 3, icon: '' }), ...(section === 'languages' && { name: '', level: '' }), ...(section === 'hobbies' && { name: '', icon: 'Heart' }), ...(section === 'socials' && { network: 'linkedin', url: '' }), ...(section === 'customSections' && { title: 'Nouvelle Section', content: '' }) };
                setCvData(prev => ({ ...prev, [section]: [...(prev[section] || []), newItem] }));
            };
            const removeListItem = (section, id) => {
                setCvData(prev => ({ ...prev, [section]: prev[section].filter(item => item.id !== id) }));
            };
            const handlePhotoChange = (e) => { if (e.target.files && e.target.files[0]) { setPhoto(URL.createObjectURL(e.target.files[0])); } };
            const toggleSectionVisibility = (section) => setVisibility(p => ({ ...p, [section]: !p[section] }));
            const toggleItemVisibility = (section, id) => setVisibility(p => ({ ...p, [section]: { ...p[section], [id]: !p[section][id] } }));
            const handleRandomizeDesign = () => {
                const randomChoice = (arr) => arr[Math.floor(Math.random() * arr.length)];
                setActiveTemplate(randomChoice(Object.keys(templates)));
                setActivePalette(randomChoice(Object.keys(palettes)));
                setActiveFont(randomChoice(Object.keys(fonts)));
                setActiveLayout(randomChoice(Object.keys(layouts)));
                setSectionTitleStyle(randomChoice(['border', 'background', 'simple']));
                setSkillDisplayStyle(randomChoice(['bars', 'stars']));
                setExperienceStyle(randomChoice(['default', 'timeline']));
                setHeaderAlignment(randomChoice(['left', 'center']));
            };
            
            // --- DRAG & DROP ---
            const handleDragStart = (e, blockId) => { setDraggedBlock(blockId); e.dataTransfer.effectAllowed = 'move'; };
            const handleDragOver = (e) => e.preventDefault();
            const handleDrop = (e, targetBlockId, targetColumn) => {
                e.preventDefault(); if (!draggedBlock) return;
                if (activeLayout === 'two') {
                    setColumnAssignment(prev => {
                        const newA = { left: prev.left.filter(id => id !== draggedBlock), right: prev.right.filter(id => id !== draggedBlock) };
                        const targetList = newA[targetColumn]; const dropIndex = targetBlockId ? targetList.indexOf(targetBlockId) : targetList.length;
                        targetList.splice(dropIndex, 0, draggedBlock); return newA;
                    });
                } else { setBlockOrder(prev => { const newO = prev.filter(id => id !== draggedBlock); const dropIndex = newO.indexOf(targetBlockId); newO.splice(dropIndex, 0, draggedBlock); return newO; }); }
                setDraggedBlock(null);
            };
            const handleDropOnColumn = (e, column) => { e.preventDefault(); if (!columnAssignment[column].length) { handleDrop(e, null, column); } };
            const invertColumns = () => setColumnAssignment(p => ({ left: p.right, right: p.left }));

            // --- AI & PDF & WORD ---
            const generatePDF = async () => {
                if (isDownloadingPdf || typeof html2pdf === 'undefined') return;
                setIsDownloadingPdf(true);
                const element = document.getElementById('cv-preview-container');
                const opt = {
                    margin: 0,
                    filename: isAnonymized ? 'cv_anonyme.pdf' : `CV_${cvData.personal.firstName || 'CV'}_${cvData.personal.lastName || 'Pro'}.pdf`,
                    image: { type: 'jpeg', quality: 1.0 },
                    html2canvas: { scale: 4, useCORS: true, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                await html2pdf().from(element).set(opt).save();
                setIsDownloadingPdf(false);
            };
            
            const generateWord = () => {
                if (typeof docx === 'undefined' || typeof saveAs === 'undefined') return;
                setIsDownloadingWord(true);
                const { Packer, Document, Paragraph, TextRun, HeadingLevel } = docx;
                const { personal, experiences, education, skills } = cvData;
                const doc = new Document({
                    sections: [{
                        children: [
                            new Paragraph({ text: `${personal.firstName} ${personal.lastName}`, heading: HeadingLevel.TITLE }),
                            new Paragraph({ text: personal.title, style: "IntenseQuote" }),
                            new Paragraph({ text: `Email: ${personal.email} | Tel: ${personal.phone} | Adresse: ${personal.address}` }),
                            new Paragraph({ text: "" }),
                            new Paragraph({ text: "Résumé", heading: HeadingLevel.HEADING_1 }),
                            new Paragraph(personal.summary),
                            new Paragraph({ text: "" }),
                            new Paragraph({ text: "Expérience Professionnelle", heading: HeadingLevel.HEADING_1 }),
                            ...experiences.flatMap(exp => [
                                new Paragraph({ children: [new TextRun({ text: exp.position, bold: true })] }),
                                new Paragraph(`${exp.company} | ${exp.startDate} - ${exp.endDate}`),
                                new Paragraph({ text: exp.description, bullet: { level: 0 } }),
                                new Paragraph(""),
                            ]),
                            new Paragraph({ text: "Formation", heading: HeadingLevel.HEADING_1 }),
                            ...education.flatMap(edu => [
                                new Paragraph({ children: [new TextRun({ text: edu.degree, bold: true })] }),
                                new Paragraph(`${edu.institution} | ${edu.startDate} - ${edu.endDate}`),
                                new Paragraph({ text: edu.description, bullet: { level: 0 } }),
                                new Paragraph(""),
                            ]),
                            new Paragraph({ text: "Compétences", heading: HeadingLevel.HEADING_1 }),
                            new Paragraph(skills.map(s => s.name).join(', ')),
                        ],
                    }],
                });
                Packer.toBlob(doc).then(blob => {
                    saveAs(blob, `CV_${personal.firstName}_${personal.lastName}.docx`);
                }).finally(() => setIsDownloadingWord(false));
            };

            const jsonSchemaForAI = { type: "OBJECT", properties: { personal: { type: "OBJECT", properties: { firstName: { type: "STRING" }, lastName: { type: "STRING" }, title: { type: "STRING" }, email: { type: "STRING" }, phone: { type: "STRING" }, address: { type: "STRING" }, summary: { type: "STRING" }, availability: { type: "STRING" }, salaryExpectations: { type: "STRING" }, location: { type: "STRING" } } }, experiences: { type: "ARRAY", items: { type: "OBJECT", properties: { company: { type: "STRING" }, position: { type: "STRING" }, startDate: { type: "STRING" }, endDate: { type: "STRING" }, description: { type: "STRING" } } } }, education: { type: "ARRAY", items: { type: "OBJECT", properties: { institution: { type: "STRING" }, degree: { type: "STRING" }, startDate: { type: "STRING" }, endDate: { type: "STRING" }, description: { type: "STRING" } } } }, projects: { type: "ARRAY", items: { type: "OBJECT", properties: { name: { type: "STRING" }, url: { type: "STRING" }, description: { type: "STRING" } } } }, awards: { type: "ARRAY", items: { type: "OBJECT", properties: { name: { type: "STRING" }, issuer: { type: "STRING" }, date: { type: "STRING" }, description: { type: "STRING" } } } }, skills: { type: "ARRAY", items: { type: "STRING" } }, languages: { type: "ARRAY", items: { type: "OBJECT", properties: { name: { type: "STRING" }, level: { type: "STRING" } } } }, hobbies: { type: "ARRAY", items: { type: "STRING" } } } };
            
            const callApi = async (payload) => {
                const apiUrl = 'https://simulateur-ltd.onrender.com/api/gemini';
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`Erreur du serveur (status ${response.status}): ${errorBody}`);
                    }
                    return response.json();
                } catch (error) {
                    console.error("Erreur de l'API:", error);
                    if (error instanceof TypeError && error.message === 'Failed to fetch') {
                        throw new Error("Impossible de joindre le serveur. L'état du serveur est 'Hors ligne'. Vérifiez que le service sur Render est bien démarré.");
                    }
                    throw error;
                }
            };

            const handleAiGenerate = async () => {
                if (!aiInput.trim()) { setAiError("Veuillez copier-coller le contenu de votre CV."); return; }
                setIsAiLoading(true); setAiError('');
                const prompt = `You are an expert CV parsing system. Your task is to meticulously analyze the following text and extract structured information to populate a CV. The user's text is: "${aiInput}". Please extract the following sections: Personal Information (first name, last name, job title, email, phone, address, summary, availability, salary expectations, location), Professional Experiences (for each job: company, position, dates, description), Projects (name, url, description), Education (for each degree: institution, degree name, dates, description), Awards (name, issuer, date, description), a list of Skills, a list of Languages with their levels, and a list of Hobbies. You must adhere to the provided JSON schema. If information is not present, leave the field as an empty string or array. Do not invent information. Return ONLY the raw JSON object, without any surrounding text or markdown.`;
                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: jsonSchemaForAI } };
                    const result = await callApi(payload);
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                        const parsedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                        setCvData(prev => ({ ...prev, personal: { ...prev.personal, ...parsedJson.personal }, experiences: (parsedJson.experiences || []).map((exp, i) => ({ id: Date.now() + i, ...exp })), projects: (parsedJson.projects || []).map((p, i) => ({ id: Date.now() + i, ...p })), education: (parsedJson.education || []).map((edu, i) => ({ id: Date.now() + i, ...edu })), awards: (parsedJson.awards || []).map((a, i) => ({ id: Date.now() + i, ...a })), skills: (parsedJson.skills || []).map((skill, i) => ({ id: Date.now() + i, name: skill, level: 3, category: 'Général' })), languages: (parsedJson.languages || []).map((lang, i) => ({ id: Date.now() + i, ...lang })), hobbies: (parsedJson.hobbies || []).map((hobby, i) => ({ id: Date.now() + i, name: hobby, icon: 'Heart' })) }));
                    } else { throw new Error("Invalid response structure from AI."); }
                } catch (e) { console.error("AI Generation Error:", e); setAiError(e.message); } finally { setIsAiLoading(false); }
            };

            const handleAiInjection = async () => {
                if (!injectionNotes.trim()) { setAiError("Veuillez entrer des notes à injecter."); return; }
                setIsInjecting(true); setAiError('');
                const prompt = `En tant qu'expert en recrutement, analyse les données de CV existantes et les notes supplémentaires, puis fusionne-les intelligemment. Met à jour les champs existants (comme la disponibilité ou le salaire) ou ajoute de nouvelles entrées (comme une expérience manquante) si nécessaire. Voici les données actuelles du CV au format JSON : ${JSON.stringify(cvData)}. Voici les notes à injecter : "${injectionNotes}". Renvoie l'intégralité des données du CV mises à jour, en respectant exactement le même format JSON. Ne renvoie que l'objet JSON brut.`;
                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json", responseSchema: jsonSchemaForAI } };
                    const result = await callApi(payload);
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                        const updatedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                        // Merge intelligently to keep IDs
                        const mergedData = {
                            ...cvData,
                            ...updatedJson,
                            experiences: updatedJson.experiences.map((exp, i) => ({...cvData.experiences[i], ...exp, id: cvData.experiences[i]?.id || Date.now() + i})),
                            // ... add similar logic for other arrays to preserve IDs
                        };
                        setCvData(mergedData);
                        await handleGenerateSalesEmail(mergedData);
                    } else { throw new Error("Invalid response structure from AI."); }
                } catch (e) { console.error("AI Injection Error:", e); setAiError(e.message); } finally { setIsInjecting(false); }
            };
            
            const handleGenerateSalesEmail = async (currentCvData = cvData) => {
                setIsGeneratingEmail(true); setAiError('');
                const prompt = `En tant qu'expert en recrutement, rédige un email de vente concis et percutant pour présenter le profil suivant à un potentiel employeur. Mets en avant les points forts du candidat en te basant sur son résumé, sa dernière expérience, et ses compétences clés. L'email doit être professionnel et inclure un appel à l'action clair. Ne mentionne PAS le nom de famille du candidat. Ne termine PAS par une formule de politesse ou une signature (ex: "Cordialement,"). Voici les données du CV : ${JSON.stringify(currentCvData)}. Ne renvoie que le texte brut du corps de l'email, sans la ligne "Objet:" ou "Subject:".`;
                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const result = await callApi(payload);
                    if (result.candidates && result.candidates[0].content.parts[0].text) {
                        setSalesEmail(result.candidates[0].content.parts[0].text);
                    } else { throw new Error("Invalid response structure from AI."); }
                } catch (e) { console.error("AI Email Generation Error:", e); setAiError(e.message); } finally { setIsGeneratingEmail(false); }
            };
            
            const copyToClipboard = (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                }).catch(err => console.error('Failed to copy: ', err));
            };
            
            // --- RENDER FUNCTIONS ---
            const IconComponent = ({ name, ...props }) => { const Icon = hobbyIcons[name] || hobbyIcons.default; return <Icon {...props} />; };
            const Tooltip = ({ text, children }) => ( <div className="relative group flex items-center"> {children} <div className="absolute bottom-full mb-2 w-max bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-30"> {text} </div> </div> );
            const Accordion = ({ title, icon: Icon, children, defaultOpen = false }) => {
                const [isOpen, setIsOpen] = useState(defaultOpen);
                return (
                    <div className="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-200">
                        <header>
                            <button onClick={() => setIsOpen(!isOpen)} className="w-full flex justify-between items-center p-4 font-bold text-gray-800 hover:bg-gray-50 transition-colors">
                                <div className="flex items-center"> {Icon && <Icon className="mr-3 text-indigo-600" size={20} />} <span className="text-md">{title}</span> </div>
                                <LucideIcons.ChevronDown size={20} className={`transform transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`} />
                            </button>
                        </header>
                        {isOpen && ( <section className="overflow-hidden"> <div className="p-5 border-t border-gray-200">{children}</div> </section> )}
                    </div>
                );
            };
            const InputField = ({ label, value, onChange, placeholder, Icon, type = 'text' }) => (
                <div>
                    <label className="block text-sm font-medium text-gray-600 mb-1 flex items-center"> {Icon && <Icon size={14} className="mr-2" />} {label} </label>
                    <input type={type} value={value} onChange={onChange} placeholder={placeholder} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" />
                </div>
            );
            const TextareaField = ({ label, value, onChange, placeholder, Icon, rows = 3, children }) => (
                <div>
                    <div className="flex justify-between items-center mb-1">
                        <label className="block text-sm font-medium text-gray-600 flex items-center"> {Icon && <Icon size={14} className="mr-2" />} {label} </label>
                        <div className="flex items-center gap-2">{children}</div>
                    </div>
                    <textarea value={value} onChange={onChange} placeholder={placeholder} rows={rows} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" />
                </div>
            );

            const renderCV = () => {
                const pData = isAnonymized ? { ...cvData.personal, lastName: `${cvData.personal.lastName.charAt(0)}.`, email: '', phone: '', address: '' } : cvData.personal;
                const getBlock = (id) => {
                    const sectionMap = {
                        personal: () => renderHeader(pData),
                        socials: () => cvData.socials?.length > 0 && visibility.socials ? renderSocials() : null,
                        experiences: () => cvData.experiences?.length > 0 ? renderExperiences() : null,
                        projects: () => cvData.projects?.length > 0 ? renderProjects() : null,
                        education: () => cvData.education?.length > 0 ? renderEducation() : null,
                        awards: () => cvData.awards?.length > 0 ? renderAwards() : null,
                        skills: () => cvData.skills?.length > 0 && visibility.skills ? renderSkills() : null,
                        languages: () => cvData.languages?.length > 0 && visibility.languages ? renderLanguages() : null,
                        hobbies: () => cvData.hobbies?.length > 0 && visibility.hobbies ? renderHobbies() : null,
                    };
                    if (id.startsWith('custom-')) {
                        const section = cvData.customSections.find(s => `custom-${s.id}` === id);
                        return section ? renderCustomSection(section) : null;
                    }
                    return sectionMap[id] ? sectionMap[id]() : null;
                };

                const renderHeader = (personalData) => ( <div className={`cv-header flex flex-col ${headerAlignment === 'center' ? 'items-center text-center' : 'items-start text-left'}`} style={{ marginBottom: `${sectionSpacing}rem` }}> {photo && !isAnonymized && ( <img src={photo} alt="User" className={`mb-4 w-32 h-32 object-cover shadow-lg`} style={{ borderRadius: photoShape === 'round' ? '50%' : '0.75rem' }} /> )} <h1 className="font-bold mb-1 text-gray-900" style={{ fontSize: `${nameFontSize}pt` }}> {personalData.firstName} {personalData.lastName} </h1> <h2 className="text-xl mb-3 font-medium" style={{ color: (palettes[activePalette] || {}).primary }}> {personalData.title} </h2> {!isAnonymized && ( <div className={`flex flex-wrap ${headerAlignment === 'center' ? 'justify-center' : ''} gap-x-6 gap-y-2 text-gray-600 mb-4 text-sm`}> <div className="flex items-center gap-2"><LucideIcons.Mail size={14} />{personalData.email}</div> <div className="flex items-center gap-2"><LucideIcons.Phone size={14} />{personalData.phone}</div> <div className="flex items-center gap-2"><LucideIcons.MapPin size={14} />{personalData.address}</div> </div> )} <div className={`flex flex-wrap ${headerAlignment === 'center' ? 'justify-center' : ''} gap-x-6 gap-y-2 text-gray-600 mb-4 text-sm`}> {(personalData.availability) && <div className="flex items-center gap-2"><LucideIcons.Calendar size={14} />{personalData.availability}</div>} {(personalData.location) && <div className="flex items-center gap-2"><LucideIcons.Map size={14} />{personalData.location}</div>} {(personalData.salaryExpectations) && <div className="flex items-center gap-2"><LucideIcons.Euro size={14} />{personalData.salaryExpectations}</div>} </div> {personalData.summary && <p className="text-gray-700 leading-relaxed max-w-3xl"> {personalData.summary} </p>} </div> );
                const renderSection = (title, content, Icon = LucideIcons.Star) => ( <div className="cv-section" style={{ marginBottom: `${sectionSpacing}rem` }}> <h3 className={`font-bold mb-3 tracking-wider flex items-center gap-2 border-b-2 pb-1`} style={{ color: (palettes[activePalette] || {}).primary, borderColor: (palettes[activePalette] || {}).primary, fontSize: `${sectionTitleFontSize}pt`, textTransform: 'uppercase' }}> <Icon size={16}/> <span>{title}</span> </h3> {content} </div> );
                const renderExperiences = () => renderSection('Expérience Professionnelle', <div className={`space-y-4 ${experienceStyle === 'timeline' ? 'timeline' : ''}`}> {cvData.experiences.filter(e => visibility.experiences[e.id]).map(e => ( <div key={e.id} className={`cv-item relative ${experienceStyle === 'timeline' ? 'timeline-item pb-4' : ''}`}> <div className="flex justify-between items-start mb-1"> <div> <h4 className="font-semibold text-base">{e.position}</h4> <p className="font-medium" style={{ color: (palettes[activePalette] || {}).accent }}>{e.company}</p> </div> <span className="font-mono whitespace-nowrap pl-4 text-sm text-gray-600">{e.startDate} - {e.endDate}</span> </div> {e.description && <p className="text-gray-600">{e.description}</p>} </div> ))} </div>, LucideIcons.Briefcase );
                const renderSkills = () => renderSection('Compétences', <div> {Object.entries(cvData.skills.reduce((acc, skill) => { (acc[skill.category] = acc[skill.category] || []).push(skill); return acc; }, {})).map(([category, skills]) => ( <div key={category} className="mb-3"> <h5 className="font-bold text-sm mb-2 text-gray-600">{category}</h5> <div className="grid grid-cols-1 md:grid-cols-2 gap-x-6" style={{ gapY: `${itemSpacing / 2}rem` }}> {skills.map(skill => ( <div key={skill.id}> <div className="flex items-center gap-2"><span className="font-medium">{skill.name}</span></div> <div className="w-full bg-gray-200 rounded-full h-2 mt-1"><div className="h-2 rounded-full" style={{ width: `${skill.level * 20}%`, backgroundColor: (palettes[activePalette] || {}).primary }}></div></div> </div> ))} </div> </div> ))} </div>, LucideIcons.Code);
                // ... other render functions (projects, education, etc.) can be defined similarly
                const renderProjects = () => renderSection('Projets', <div>{/* ... */}</div>);
                const renderEducation = () => renderSection('Formation', <div>{/* ... */}</div>);
                const renderAwards = () => renderSection('Récompenses', <div>{/* ... */}</div>);
                const renderLanguages = () => renderSection('Langues', <div>{/* ... */}</div>);
                const renderHobbies = () => renderSection('Centres d\'intérêt', <div>{/* ... */}</div>);
                const renderSocials = () => renderSection('Réseaux & Liens', <div>{/* ... */}</div>);
                const renderCustomSection = (section) => renderSection(section.title, <p>{section.content}</p>);

                const { left: leftCol, right: rightCol } = { 'large-right': { left: 'w-1/3', right: 'w-2/3' }, 'equal': { left: 'w-1/2', right: 'w-1/2' }, 'large-left': { left: 'w-2/3', right: 'w-1/3' } }[columnRatio];
                const content = activeLayout === 'two' ? ( <div className="flex h-full" style={{ gap: `${pagePadding}rem` }}> <div className={`${leftCol} flex flex-col`}>{columnAssignment.left.map(id => <React.Fragment key={id}>{getBlock(id)}</React.Fragment>)}</div> <div className={`${rightCol} flex flex-col`}>{columnAssignment.right.map(id => <React.Fragment key={id}>{getBlock(id)}</React.Fragment>)}</div> </div> ) : ( <React.Fragment> {getBlock('personal')} <div className="flex flex-col">{blockOrder.map(id => <React.Fragment key={id}>{getBlock(id)}</React.Fragment>)}</div> </React.Fragment> );
                
                return (
                    <div id="cv-preview-container" className="bg-white" style={{ width: '210mm', height: '297mm', boxSizing: 'border-box', overflow: 'hidden' }}>
                        <div id="cv-preview" className={`text-gray-800`} style={{ fontFamily: fonts[activeFont].family, backgroundColor: '#ffffff', boxSizing: 'border-box', width: '100%', height: '100%', '--primary-color': (palettes[activePalette] || {}).primary }}>
                            <div ref={cvContentRef} className="h-full w-full flex flex-col relative" style={{ fontSize: `${baseFontSize}pt`, lineHeight: lineHeight }}>
                                {showRecruiterBanner && <div className="flex justify-between items-center p-4 border-b-2" style={{ borderColor: (palettes[activePalette] || {}).primary }}> <div className="text-2xl font-bold" style={{ color: (palettes[activePalette] || {}).accent }}>{recruiterData.company}</div> <div className="text-right text-xs"> <p className="font-bold">{recruiterData.name}</p> <p>{recruiterData.title}</p> <p>Fixe: {recruiterData.phone} / Mobile: {recruiterData.mobile}</p> <p>Mail: {recruiterData.email}</p> </div> </div>}
                                <div className="flex-grow" style={{padding: `${pagePadding}rem`}}>{content}</div>
                                {showVCardQR && !isAnonymized && <div ref={vCardQrCodeRef} className="absolute bottom-4 right-4 bg-white p-2 rounded-md shadow-lg"></div>}
                            </div>
                        </div>
                    </div>
                );
            };
            
            // --- RENDER EDITOR ---
            const isCvEmpty = !cvData.personal.firstName && !cvData.personal.lastName && cvData.experiences.length === 0;
            
            const renderEditor = () => (
                <div className="bg-white rounded-xl shadow-sm">
                    <div className="border-b border-gray-200">
                        <nav className="-mb-px flex space-x-1 overflow-x-auto p-2" aria-label="Tabs">
                            {editorTabs.map(tab => (
                                <button key={tab.id} onClick={() => setActiveEditorTab(tab.id)} className={`whitespace-nowrap flex items-center py-3 px-4 font-medium text-sm rounded-lg transition-colors ${activeEditorTab === tab.id ? 'bg-indigo-100 text-indigo-700' : 'text-gray-500 hover:text-gray-700 hover:bg-gray-50'}`}>
                                    <tab.icon className="mr-2 h-5 w-5" />
                                    {tab.label}
                                </button>
                            ))}
                        </nav>
                    </div>

                    <div className="p-6">
                        {activeEditorTab === 'ia' && (
                            <div className="space-y-4">
                                <TextareaField label="Copiez et collez le contenu de votre CV ici" value={aiInput} onChange={(e) => setAiInput(e.target.value)} placeholder={"Ex: Léa Martin\nDéveloppeuse Full-Stack..."} rows={6} Icon={LucideIcons.FileText} />
                                <button onClick={handleAiGenerate} disabled={isAiLoading} className="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 transition-colors disabled:bg-indigo-300"> {isAiLoading ? <LucideIcons.LoaderCircle size={16} /> : <LucideIcons.Sparkles size={16} />} {isAiLoading ? 'Analyse...' : 'Remplir le formulaire'} </button>
                                {aiError && <p className="text-red-500 text-sm mt-2">{aiError}</p>}
                            </div>
                        )}
                        {activeEditorTab === 'contenu' && (
                            <div className="space-y-4">
                                <Accordion title="Informations Personnelles" icon={LucideIcons.User} defaultOpen>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <InputField label="Prénom" value={cvData.personal.firstName} onChange={(e) => handleCvDataChange('personal', 'firstName', e.target.value)} Icon={LucideIcons.User} />
                                        <InputField label="Nom" value={cvData.personal.lastName} onChange={(e) => handleCvDataChange('personal', 'lastName', e.target.value)} Icon={LucideIcons.User} />
                                        {/* ... More fields ... */}
                                    </div>
                                </Accordion>
                                <Accordion title="Expériences" icon={LucideIcons.Briefcase}>
                                    <div className="space-y-4">
                                        {cvData.experiences.map((exp, index) => (
                                            <div key={exp.id} className="p-4 border rounded-lg bg-gray-50 space-y-3 relative">
                                                <div className="flex justify-between items-center">
                                                    <h4 className="font-semibold">Expérience #{index + 1}</h4>
                                                    <button onClick={() => removeListItem('experiences', exp.id)} className="p-1 text-red-500 hover:bg-red-100 rounded-full"><LucideIcons.Trash2 size={16} /></button>
                                                </div>
                                                {/* ... Experience fields ... */}
                                            </div>
                                        ))}
                                        <button onClick={() => addListItem('experiences')} className="w-full px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 flex items-center justify-center gap-2 transition-colors">
                                            <LucideIcons.Plus size={16} /> Ajouter une expérience
                                        </button>
                                    </div>
                                </Accordion>
                            </div>
                        )}
                        {/* ... Other tabs ... */}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50 p-2 md:p-6">
                    <div className="max-w-screen-2xl mx-auto">
                        <header className="bg-white rounded-xl shadow-md p-4 mb-6 flex flex-wrap justify-between items-center gap-4 sticky top-4 z-20">
                            <h1 className="text-xl font-bold text-gray-800">Créateur de CV Pro</h1>
                            <div className="flex items-center flex-wrap gap-x-4 gap-y-2">
                                <div className="flex items-center gap-2 text-sm">
                                    <span className="font-medium">État du serveur:</span>
                                    {connectionStatus === 'ok' && <span className="px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full">En ligne</span>}
                                    {connectionStatus === 'error' && <span className="px-2 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full">Hors ligne / Erreur</span>}
                                    {(connectionStatus === 'pending' || connectionStatus === 'testing') && <span className="px-2 py-1 text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full">Vérification...</span>}
                                    <button onClick={testBackendConnection} className="p-1 rounded-full hover:bg-gray-200" title="Tester la connexion au serveur">
                                        <LucideIcons.RefreshCcw size={14} className={connectionStatus === 'testing' ? 'spin' : ''} />
                                    </button>
                                </div>
                                <div className="flex items-center gap-2">
                                    <button onClick={generatePDF} disabled={isDownloadingPdf} className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2 transition-colors disabled:bg-indigo-300 w-44"> {isDownloadingPdf ? <LucideIcons.LoaderCircle size={16} /> : <LucideIcons.Download size={16} />} {isDownloadingPdf ? 'Téléchargement...' : 'Télécharger PDF'} </button>
                                    <button onClick={generateWord} disabled={isDownloadingWord} className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 transition-colors disabled:bg-blue-300 w-44"> {isDownloadingWord ? <LucideIcons.LoaderCircle size={16} /> : <LucideIcons.FileText size={16} />} {isDownloadingWord ? 'Génération...' : 'Télécharger Word'} </button>
                                </div>
                            </div>
                        </header>
                        <div className={`grid ${previewMode ? 'grid-cols-1' : 'grid-cols-1 xl:grid-cols-[1fr,1.5fr]'} gap-8 items-start`}>
                            {!previewMode && ( <div className="space-y-6"> {renderEditor()} </div> )}
                            <div className="flex flex-col items-center sticky top-28">
                                {isOverflowing && !isCvEmpty && (
                                    <div className="w-full flex items-center gap-3 bg-red-100 border border-red-400 text-red-800 px-4 py-2 rounded-lg mb-4">
                                        <LucideIcons.AlertTriangle size={24} />
                                        <div>
                                            <h4 className="font-bold">Le contenu dépasse la page !</h4>
                                            <p className="text-sm">Votre CV est trop long. Pensez à réduire le texte.</p>
                                        </div>
                                    </div>
                                )}
                                <div className="w-full flex justify-center items-center gap-2 mb-4 bg-white p-2 rounded-lg shadow-sm">
                                    <input type="range" min="0.3" max="1.5" step="0.01" value={previewScale} onChange={e => setPreviewScale(parseFloat(e.target.value))} className="w-32" />
                                    <span className="text-sm font-mono text-gray-500">{Math.round(previewScale * 100)}%</span>
                                </div>
                                
                                {isCvEmpty ? (
                                    <div className="flex flex-col items-center justify-center text-center text-gray-500 bg-gray-100 rounded-lg p-10 w-[210mm]" style={{transform: `scale(${previewScale})`, height: '297mm'}}>
                                        <LucideIcons.FileText size={48} className="mb-4" />
                                        <h3 className="text-xl font-semibold text-gray-700">Votre CV est vide</h3>
                                        <p className="mt-2 max-w-sm">Utilisez l'assistant IA ou remplissez les sections pour commencer.</p>
                                    </div>
                                ) : (
                                    <div ref={cvPreviewRef} className="origin-top shadow-2xl transition-transform duration-300" style={{ transform: `scale(${previewScale})` }}> 
                                        {renderCV()} 
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<CVGenerator />, document.getElementById('root'));

    </script>

</body>
</html>
